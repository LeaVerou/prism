<!DOCTYPE html>
<html lang="en">
<head>

<meta charset="utf-8" />
<link rel="icon" href="favicon.png" />
<title>Test drive â–² Prism</title>
<link rel="stylesheet" href="style.css" />
<link rel="stylesheet" href="themes/prism.css" data-noprefix />
<style>
#theme {
	margin-right: -9em;
}

textarea {
	width: 100%;
	height: 10em;
	padding: 1em;
	box-sizing: border-box;
	margin: .5em 0;
	background: #f5f2f0;
	color: black;
	text-shadow: 0 1px white;
	tab-size: 4;
	font: 100% Consolas, Monaco, monospace;
	white-space: pre;
	word-wrap: normal;
}

#language {
	column-count: 4;
}

	#language label {
		display: block;
		padding: .2em;
	}

	#language label[data-id="javascript"] {
		border-bottom: 1px solid #aaa;
		padding-bottom: 1em;
		margin-bottom: 1em;
	}

	#language input {
		margin-right: 1em;
	}

	#language strong {
		display: block;
		column-span: all;
	}

</style>
<!-- Line Numbers -->
<style>
	pre[class*="language-"].line-numbers {
		position: relative;
		padding-left: 3.8em;
		counter-reset: linenumber;
	}

	pre[class*="language-"].line-numbers > code {
		position: relative;
		white-space: inherit;
	}

	.line-numbers .line-numbers-rows {
		position: absolute;
		pointer-events: none;
		top: 0;
		font-size: 100%;
		left: -3.8em;
		width: 3em; /* works for line-numbers below 1000 lines */
		letter-spacing: -1px;
		border-right: 1px solid #999;

		-webkit-user-select: none;
		-moz-user-select: none;
		-ms-user-select: none;
		user-select: none;

	}

	.line-numbers-rows > span {
		pointer-events: none;
		display: block;
		counter-increment: linenumber;
	}

	.line-numbers-rows > span:before {
		content: counter(linenumber);
		color: #999;
		display: block;
		padding-right: 0.8em;
		text-align: right;
	}	
</style>
<script src="prefixfree.min.js"></script>

<script>var _gaq = [['_setAccount', 'UA-33746269-1'], ['_trackPageview']];</script>
<script src="https://www.google-analytics.com/ga.js" async></script>
</head>
<body>

<header>
	<div class="intro" data-src="templates/header-main.html" data-type="text/html"></div>

	<h2>Test drive</h2>
	<p>Take Prism for a spin!</p>
</header>

<section>
	<form>
		<p>
			<textarea>&lt;p class="hey">Type some code here&lt;/p></textarea>
		</p>

		<p>Result:</p>
		<p>
			<input type="checkbox" name="line-numbers" id="line-numbers">
			<label for="line-numbers">Enable Line Numbers</label>
		</p>
		<pre><code></code></pre>

		<p id="language">
			<strong>Language:</strong>
		</p>
	</form>
</section>

<footer data-src="templates/footer.html" data-type="text/html"></footer>

<script src="prism.js"></script>
<script src="utopia.js"></script>
<script src="components.js"></script>
<script src="code.js"></script>
<script src="vendor/promise.js"></script>
<!-- Line Numbers -->
<script>
	(function () {

		if (typeof self === 'undefined' || !self.Prism || !self.document) {
			return;
		}

		/**
		 * Plugin name which is used as a class name for <pre> which is activating the plugin
		 * @type {String}
		 */
		var PLUGIN_NAME = 'line-numbers';
		
		/**
		 * Regular expression used for determining line breaks
		 * @type {RegExp}
		 */
		var NEW_LINE_EXP = /\n(?!$)/g;

		/**
		 * Resizes line numbers spans according to height of line of code
		 * @param {Element} element <pre> element
		 */
		var _resizeElement = function (element) {
			var codeStyles = getStyles(element);
			var whiteSpace = codeStyles['white-space'];

			if (whiteSpace === 'pre-wrap' || whiteSpace === 'pre-line') {
				var codeElement = element.querySelector('code');
				var lineNumbersWrapper = element.querySelector('.line-numbers-rows');
				var lineNumberSizer = element.querySelector('.line-numbers-sizer');
				var codeLines = codeElement.textContent.split(NEW_LINE_EXP);

				if (!lineNumberSizer) {
					lineNumberSizer = document.createElement('span');
					lineNumberSizer.className = 'line-numbers-sizer';

					codeElement.appendChild(lineNumberSizer);
				}

				lineNumberSizer.style.display = 'block';

				codeLines.forEach(function (line, lineNumber) {
					lineNumberSizer.textContent = line || '\n';
					var lineSize = lineNumberSizer.getBoundingClientRect().height;
					lineNumbersWrapper.children[lineNumber].style.height = lineSize + 'px';
				});

				lineNumberSizer.textContent = '';
				lineNumberSizer.style.display = 'none';
			}
		};

		/**
		 * Returns style declarations for the element
		 * @param {Element} element
		 */
		var getStyles = function (element) {
			if (!element) {
				return null;
			}

			return window.getComputedStyle ? getComputedStyle(element) : (element.currentStyle || null);
		};

		window.addEventListener('resize', function () {
			Array.prototype.forEach.call(document.querySelectorAll('pre.' + PLUGIN_NAME), _resizeElement);
		});

		Prism.hooks.add('complete', function (env) {
			if (!env.code) {
				return;
			}

			// works only for <code> wrapped inside <pre> (not inline)
			var pre = env.element.parentNode;
			var clsReg = /\s*\bline-numbers\b\s*/;
			if (
				!pre || !/pre/i.test(pre.nodeName) ||
				// Abort only if nor the <pre> nor the <code> have the class
				(!clsReg.test(pre.className) && !clsReg.test(env.element.className))
			) {
				return;
			}

			if (env.element.querySelector('.line-numbers-rows')) {
				// Abort if line numbers already exists
				return;
			}

			if (clsReg.test(env.element.className)) {
				// Remove the class 'line-numbers' from the <code>
				env.element.className = env.element.className.replace(clsReg, ' ');
			}
			if (!clsReg.test(pre.className)) {
				// Add the class 'line-numbers' to the <pre>
				pre.className += ' line-numbers';
			}

			var match = env.code.match(NEW_LINE_EXP);
			var linesNum = match ? match.length + 1 : 1;
			var lineNumbersWrapper;

			var lines = new Array(linesNum + 1);
			lines = lines.join('<span></span>');

			lineNumbersWrapper = document.createElement('span');
			lineNumbersWrapper.setAttribute('aria-hidden', 'true');
			lineNumbersWrapper.className = 'line-numbers-rows';
			lineNumbersWrapper.innerHTML = lines;

			if (pre.hasAttribute('data-start')) {
				pre.style.counterReset = 'linenumber ' + (parseInt(pre.getAttribute('data-start'), 10) - 1);
			}

			env.element.appendChild(lineNumbersWrapper);

			_resizeElement(pre);

			Prism.hooks.run('line-numbers', env);
		});

		Prism.hooks.add('line-numbers', function (env) {
			env.plugins = env.plugins || {};
			env.plugins.lineNumbers = true;
		});
		
		/**
		 * Global exports
		 */
		Prism.plugins.lineNumbers = {
			/**
			 * Get node for provided line number
			 * @param {Element} element pre element
			 * @param {Number} number line number
			 * @return {Element|undefined}
			 */
			getLine: function (element, number) {
				if (element.tagName !== 'PRE' || !element.classList.contains(PLUGIN_NAME)) {
					return;
				}

				var lineNumberRows = element.querySelector('.line-numbers-rows');
				var lineNumberStart = parseInt(element.getAttribute('data-start'), 10) || 1;
				var lineNumberEnd = lineNumberStart + (lineNumberRows.children.length - 1);

				if (number < lineNumberStart) {
					number = lineNumberStart;
				}
				if (number > lineNumberEnd) {
					number = lineNumberEnd;
				}

				var lineIndex = number - lineNumberStart;

				return lineNumberRows.children[lineIndex];
			}
		};

	}());	
</script>

<script>
(function() {
var form = $('form'), code = $('code', form),
    languages = components.languages,
    highlightCode = function() { Prism.highlightElement(code); };

for (var id in languages) {
	if (id == 'meta') {
		continue;
	}

	var name = languages[id].title || languages[id];

	$u.element.create('label', {
		attributes: {
			'data-id': id
		},
		contents: [
			{
				tag: 'input',
				properties: {
					type: 'radio',
					name: 'language',
					value: id,
					onclick: function () {
						var lang = this.value;
						code.className = 'language-' + lang;
						code.textContent = code.textContent;

						// loadLanguage() returns a promise, so we use highlightCode()
						// as resolve callback. The promise will be immediately
						// resolved if there is nothing to load.
						loadLanguage(lang).then(highlightCode);
					}
				}
			}, name
		],
		inside: '#language'
	});
}


/**
 * Loads a language, including all dependencies
 *
 * @param {string} lang the language to load
 * @type {Promise} the promise which resolves as soon as everything is loaded
 */
function loadLanguage (lang)
{
	// at first we need to fetch all dependencies for the main language
	// Note: we need to do this, even if the main language already is loaded (just to be sure..)
	//
	// We load an array of all dependencies and call recursively this function on each entry
	//
	// dependencies is now an (possibly empty) array of loading-promises
	var dependencies = getDependenciesOfLanguage(lang).map(loadLanguage);

	// We create a promise, which will resolve, as soon as all dependencies are loaded.
	// They need to be fully loaded because the main language may extend them.
	return Promise.all(dependencies)
		.then(function () {

			// If the main language itself isn't already loaded, load it now
			// and return the newly created promise (we chain the promises).
			// If the language is already loaded, just do nothing - the next .then()
			// will immediately be called
			if (!Prism.languages[lang]) {
				return new Promise(function (resolve) {
					$u.script('components/prism-' + lang + '.js', resolve);
				});
			}
		});
}


/**
 * Returns all dependencies (as identifiers) of a specific language
 *
 * @param {string} lang
 * @returns {Array.<string>} the list of dependencies. Empty if the language has none.
 */
function getDependenciesOfLanguage (lang)
{
	if (!components.languages[lang] || !components.languages[lang].require)
	{
		return [];
	}

	return ($u.type(components.languages[lang].require) === "array")
		? components.languages[lang].require
		: [components.languages[lang].require];
}


var radios = $$('input[name=language]');
radios[0].checked = true;
radios[0].onclick();

var textarea = $('textarea', form);

(textarea.oninput = function() {
	code.textContent = this.value || '';
	highlightCode();
}).call(textarea);

// Line Numbers Switcher
var $lineNumbersBtn    = document.getElementById("line-numbers");
$lineNumbersBtn && $lineNumbersBtn.addEventListener("click", function(){

	document.querySelector("pre").classList.toggle("line-numbers");
	highlightCode();

});

})();


</script>

</body>
</html>
